<div style="font-family: Arial, sans-serif; font-size: 9pt; color: #000; max-width: 8.27in; margin: 0 auto; border: 1px solid #000; padding: 0;">
    <!-- Header Section - Single Image with border -->
    <div style="margin: 0; text-align: center; border-bottom: 1px solid #000;">
        <img src="/assets/custom_invoice/images/pr_plastics_header.png" alt="PR Plastics Header" style="width: 100%; max-width: 800px; height: auto; display: block;">
    </div>

    <!-- GSTIN and Invoice Title Row -->
    <div style="display: flex; border-bottom: 1px solid #000; margin-bottom: 0;">
        <div style="flex: 1; border-right: 1px solid #000; padding: 1px 5px; font-size: 8pt;">
            <strong>GSTIN: 33ATNPR3816R1ZW</strong>
        </div>
        <div style="flex: 1; border-right: 1px solid #000; padding: 1px 5px; text-align: center;">
            <strong style="font-size: 10pt;">INVOICE</strong>
        </div>
        <div style="flex: 1; padding: 1px 5px; text-align: right; font-size: 8pt;">
            <strong>Triplicate</strong>
        </div>
    </div>

    <!-- Customer and Invoice Details Section - REDUCED HEIGHT -->
    <div style="display: flex; border-bottom: 1px solid #000; margin-bottom: 0;">
        <div style="flex: 1; border-right: 1px solid #000; padding: 2px 5px;">
            <p style="margin: 0 0 1px 0; font-weight: bold; font-size: 8pt;">Customer Details</p>
            <p style="font-size: 8pt; margin: 0; line-height: 1;">{{ doc.customer_name }}</p>
            <p style="font-size: 8pt; margin: 0; line-height: 1;">{{ doc.address_display or '' }}</p>
            {% if doc.contact_display %}
            <p style="font-size: 8pt; margin: 0; line-height: 1;">{{ doc.contact_display }}</p>
            {% endif %}
        </div>
        <div style="flex: 1; padding: 2px 5px;">
            <table style="width: 100%; font-size: 8pt; border-spacing: 0; line-height: 1;">
                <tr>
                    <td style="padding: 0 2px 0 0; white-space: nowrap;"><strong>Invoice No</strong>:</td>
                    <td style="padding: 0;">{{ doc.name }}</td>
                </tr>
                <tr>
                    <td style="padding: 0 2px 0 0; white-space: nowrap;"><strong>Invoice Date</strong>:</td>
                    <td style="padding: 0;">{{ doc.posting_date }}</td>
                </tr>
                <tr>
                    <td style="padding: 0 2px 0 0; white-space: nowrap;"><strong>Dispatched Through</strong>:</td>
                    <td style="padding: 0;">{{ doc.dispatched_through or '' }}</td>
                </tr>
                <tr>
                    <td style="padding: 0 2px 0 0; white-space: nowrap;"><strong>Payment Method</strong>:</td>
                    <td style="padding: 0;">{{ doc.payment_terms_template or '' }}</td>
                </tr>
                <tr>
                    <td style="padding: 0 2px 0 0; white-space: nowrap;"><strong>E.Way Bill No</strong>:</td>
                    <td style="padding: 0;">{{ doc.eway_bill_no or '' }}</td>
                </tr>
            </table>
        </div>
    </div>

    <!-- Order Details, Control No, Packing Details Section - REDUCED HEIGHT -->
    <div style="display: flex; border-bottom: 1px solid #000; margin-bottom: 0;">
        <div style="flex: 1; border-right: 1px solid #000; padding: 2px 5px;">
            <p style="margin: 0 0 1px 0; font-weight: bold; text-align: center; font-size: 8pt;">Order Details</p>
            <p style="font-size: 8pt; margin: 0; line-height: 1;">{{ doc.order_details or '' }}</p>
        </div>
        <div style="flex: 1; border-right: 1px solid #000; padding: 2px 5px;">
            <p style="margin: 0 0 1px 0; font-weight: bold; text-align: center; font-size: 8pt;">Control No</p>
            <p style="font-size: 8pt; margin: 0; line-height: 1;">{{ doc.control_no_new or '' }}</p>
        </div>
        <div style="flex: 1; padding: 2px 5px;">
            <p style="margin: 0 0 1px 0; font-weight: bold; text-align: center; font-size: 8pt;">Packing Details</p>
            <p style="font-size: 8pt; margin: 0; line-height: 1;">{{ doc.packing_details_new or '' }}</p>
        </div>
    </div>

    <!-- Items Table - Properly aligned with fixed column widths -->
    <table style="width: 100%; border-collapse: collapse; font-size: 8pt; margin-bottom: 0;">
        <thead>
            <tr>
                <th style="border: 1px solid #000; padding: 1px; text-align: center; width: 5%;">S.No.</th>
                <th style="border: 1px solid #000; padding: 1px; text-align: center; width: 12%;">Part No.</th>
                <th style="border: 1px solid #000; padding: 1px; text-align: center; width: 12%;">Consumer<br>Part No.</th>
                <th style="border: 1px solid #000; padding: 1px; text-align: center; width: 26%;">Description Of Goods</th>
                <th style="border: 1px solid #000; padding: 1px; text-align: center; width: 10%;">HSN/SAC</th>
                <th style="border: 1px solid #000; padding: 1px; text-align: center; width: 10%;">Quantity</th>
                <th style="border: 1px solid #000; padding: 1px; text-align: center; width: 10%;">Rate</th>
                <th style="border: 1px solid #000; padding: 1px; text-align: center; width: 15%;">Total</th>
            </tr>
        </thead>
        <tbody>
            {% for item in doc.items %}
            <tr>
                <td style="border-left: 1px solid #000; border-right: 1px solid #000; padding: 1px; text-align: center; width: 5%; font-size: 8pt;">{{ loop.index }}</td>
                <td style="border-right: 1px solid #000; padding: 1px; text-align: center; width: 12%; font-size: 8pt;">{{ item.item_code }}</td>
                <td style="border-right: 1px solid #000; padding: 1px; text-align: center; width: 12%; font-size: 8pt;">{{ item.customer_part_no or '' }}</td>
                <td style="border-right: 1px solid #000; padding: 1px; width: 26%; font-size: 8pt;">{{ item.description_of_goods or item.description or '' }}</td>
                <td style="border-right: 1px solid #000; padding: 1px; text-align: center; width: 10%; font-size: 8pt;">{{ item.hsn_sac_code or '' }}</td>
                <td style="border-right: 1px solid #000; padding: 1px; text-align: center; width: 10%; font-size: 8pt;">{{ item.qty }}</td>
                <td style="border-right: 1px solid #000; padding: 1px; text-align: right; width: 10%; font-size: 8pt;">{{ "{:,.2f}".format(item.rate) }}</td>
                <td style="border-right: 1px solid #000; padding: 1px; text-align: right; width: 15%; font-size: 8pt;">{{ "{:,.2f}".format(item.amount) }}</td>
            </tr>
            {% endfor %}
            
            <!-- Empty rows to fill space if needed - with column borders but no row borders -->
            {% set remaining_rows = 5 - doc.items|length %}
            {% if remaining_rows > 0 and remaining_rows <= 5 %}
                {% for i in range(remaining_rows) %}
                <tr style="height: 14px;">
                    <td style="border-left: 1px solid #000; border-right: 1px solid #000; width: 5%;">&nbsp;</td>
                    <td style="border-right: 1px solid #000; width: 12%;">&nbsp;</td>
                    <td style="border-right: 1px solid #000; width: 12%;">&nbsp;</td>
                    <td style="border-right: 1px solid #000; width: 26%;">&nbsp;</td>
                    <td style="border-right: 1px solid #000; width: 10%;">&nbsp;</td>
                    <td style="border-right: 1px solid #000; width: 10%;">&nbsp;</td>
                    <td style="border-right: 1px solid #000; width: 10%;">&nbsp;</td>
                    <td style="border-right: 1px solid #000; width: 15%;">&nbsp;</td>
                </tr>
                {% endfor %}
            {% endif %}
        </tbody>
        <tfoot>
            <!-- Total row - Properly aligned with the columns above -->
            <tr>
                <td colspan="5" style="border: 1px solid #000; padding: 1px; text-align: right; font-weight: bold; width: 65%;">Total</td>
                <td style="border: 1px solid #000; padding: 1px; text-align: center; width: 10%;">{{ doc.total_qty }}</td>
                <td style="border: 1px solid #000; padding: 1px; width: 10%;">&nbsp;</td>
                <td style="border: 1px solid #000; padding: 1px; text-align: right; font-weight: bold; width: 15%;">{{ "{:,.2f}".format(doc.total) }}</td>
            </tr>
        </tfoot>
    </table>

    <!-- Total in words and Additional Details -->
    <div style="display: flex; margin-bottom: 0;">
        <div style="flex: 6; border-left: 1px solid #000; border-right: 1px solid #000; border-bottom: 1px solid #000; padding: 1px 5px; font-size: 8pt;">
            <p style="margin: 0;"><strong>Total in words:</strong> {{ doc.in_words }}</p>
        </div>
        <div style="flex: 4; border-right: 1px solid #000; border-bottom: 1px solid #000; padding: 1px 5px; font-size: 8pt; text-align: right;">
            <p style="margin: 0; font-weight: bold;">Add:</p>
        </div>
    </div>

    <!-- Additional Charges Section -->
    <div style="display: flex; margin-bottom: 0;">
        <div style="flex: 6; border-left: 1px solid #000; border-right: 1px solid #000; border-bottom: 1px solid #000; padding: 1px 5px; font-size: 8pt;">
            <p style="margin: 0;"><strong>Bank Details</strong></p>
            <p style="margin: 0; font-size: 8pt; line-height: 1;">
                {% set company_address = frappe.get_doc("Address", doc.company_address) if doc.company_address else None %}
                {% if company_address and company_address.bank_details %}
                    {{ company_address.bank_details }}
                {% endif %}
            </p>
        </div>
        <div style="flex: 4; border-right: 1px solid #000; border-bottom: 1px solid #000; padding: 0; font-size: 7pt;">
            <table style="width: 100%; border-collapse: collapse; line-height: 1;">
                <tr style="border-bottom: 1px solid #000;">
                    <td style="padding: 1px 5px; text-align: left; border-right: 1px solid #000;">Freight Charges</td>
                    <td style="padding: 1px 5px; text-align: right;">{{ "{:,.2f}".format(doc.freight_charges or 0) }}</td>
                </tr>
                <tr style="border-bottom: 1px solid #000;">
                    <td style="padding: 1px 5px; text-align: left; border-right: 1px solid #000;">Misc Charges</td>
                    <td style="padding: 1px 5px; text-align: right;">{{ "{:,.2f}".format(doc.misc_charges or 0) }}</td>
                </tr>
                <tr style="border-bottom: 1px solid #000;">
                    <td style="padding: 1px 5px; text-align: left; border-right: 1px solid #000;">Taxable Value</td>
                    <td style="padding: 1px 5px; text-align: right;">{{ "{:,.2f}".format(doc.net_total) }}</td>
                </tr>
                <tr style="border-bottom: 1px solid #000;">
                    <td style="padding: 1px 5px; text-align: left; border-right: 1px solid #000;">CGST</td>
                    <td style="padding: 1px 5px; text-align: right;">
                        {% set cgst_amount = 0 %}
                        {% for tax in doc.taxes %}
                            {% if tax.description and 'CGST' in tax.description %}
                                {% set cgst_amount = tax.tax_amount %}
                            {% endif %}
                        {% endfor %}
                        {{ "{:,.2f}".format(cgst_amount) }}
                    </td>
                </tr>
                <tr style="border-bottom: 1px solid #000;">
                    <td style="padding: 1px 5px; text-align: left; border-right: 1px solid #000;">SGST</td>
                    <td style="padding: 1px 5px; text-align: right;">
                        {% set sgst_amount = 0 %}
                        {% for tax in doc.taxes %}
                            {% if tax.description and 'SGST' in tax.description %}
                                {% set sgst_amount = tax.tax_amount %}
                            {% endif %}
                        {% endfor %}
                        {{ "{:,.2f}".format(sgst_amount) }}
                    </td>
                </tr>
                <tr>
                    <td style="padding: 1px 5px; text-align: left; font-weight: bold; border-right: 1px solid #000;">Total Invoice value</td>
                    <td style="padding: 1px 5px; text-align: right; font-weight: bold;">{{ "{:,.2f}".format(doc.grand_total) }}</td>
                </tr>
            </table>
        </div>
    </div>

    <!-- Terms and Certification -->
    <div style="display: flex; margin-bottom: 0;">
        <div style="flex: 6; border-left: 1px solid #000; border-right: 1px solid #000; border-bottom: 1px solid #000; padding: 1px 5px; font-size: 8pt;">
            <p style="margin: 0;"><strong>Terms and Conditions</strong></p>
            <p style="margin: 0; font-size: 8pt; line-height: 1;">{{ doc.terms or '' }}</p>
        </div>
        <div style="flex: 4; border-right: 1px solid #000; border-bottom: 1px solid #000; padding: 1px 5px; font-size: 8pt;">
            <p style="margin: 0; text-align: center; line-height: 1;">Certified that the particulars given above are true and correct.</p>
            <p style="margin: 0; text-align: center; font-weight: bold; line-height: 1;">For   PR Plastics</p>
            <div style="margin-top: 20px; text-align: center;">
                <p style="margin: 0; border-top: 1px solid #000; display: inline-block; padding-top: 1px;">Authorised signatory</p>
            </div>
        </div>
    </div>
</div>